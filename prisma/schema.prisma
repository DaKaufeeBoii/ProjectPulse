generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Project {
  id          String   @id @default(cuid())
  name        String
  description String?
  status      String   @default("active") // active, completed, at-risk, paused
  deadline    DateTime
  budget      Float
  spent       Float    @default(0)
  riskScore   Int      @default(0)
  riskReason  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tasks       Task[]
  messages    Message[]
  teamId      String?
  team        Team?    @relation(fields: [teamId], references: [id], onDelete: SetNull)
}

model Task {
  id          String   @id @default(cuid())
  title       String
  description String?
  status      String   @default("todo") // todo, in-progress, done, blocked
  priority    String   @default("medium") // low, medium, high
  assignee    String?
  dueDate     DateTime?
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Message {
  id        String   @id @default(cuid())
  content   String
  author    String
  avatar    String?
  projectId String
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model BudgetEntry {
  id          String   @id @default(cuid())
  projectId   String
  description String
  amount      Float
  type        String   // expense, income
  category    String
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
}

model User {
  id               String       @id @default(cuid())
  name             String
  email            String       @unique
  passwordHash     String
  role             String       @default("employee") // admin | manager | employee
  verified         Boolean      @default(false)
  verificationCode String?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  teamMemberships  TeamMember[]
}

model Team {
  id          String       @id @default(cuid())
  name        String
  description String?
  createdBy   String       // userId of the creator
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  members     TeamMember[]
  projects    Project[]
}

model TeamMember {
  id        String   @id @default(cuid())
  teamId    String
  userId    String
  team      Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  joinedAt  DateTime @default(now())

  @@unique([teamId, userId])
}
